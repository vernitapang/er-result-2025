<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2025 Election Results - MAL</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #f4f4f4; }
    .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem; }
    h2, h3 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    .toggle-btn { margin-top: 10px; margin-bottom: 10px; padding: 6px 12px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .highlight { background-color: #fff38c; font-weight: bold; }
  </style>
</head>
<body>
  <h1>2025 Election Results Dashboard - Malolos, Bulacan</h1>
  <div id="dashboard"></div>

  <script>
    const startId = 14100009;
    const endId = 14100165;
    const dashboard = document.getElementById('dashboard');

    const aggregate = {};

    const accumulateVotes = (contests, scope) => {
      contests.forEach(contest => {
        const key = `${scope} - ${contest.contestName}`;
        if (!aggregate[key]) {
          aggregate[key] = {};
        }
        contest.candidates.candidates.forEach(candidate => {
          if (!aggregate[key][candidate.name]) {
            aggregate[key][candidate.name] = 0;
          }
          aggregate[key][candidate.name] += candidate.votes;
        });
      });
    };

    const getHighlightLimit = (raceName) => {
      if (raceName.includes("SENATOR")) return 12;
      if (raceName.includes("MEMBER, HOUSE OF REPRESENTATIVES")) return 1;
      if (raceName.includes("GOVERNOR")) return 1;
      if (raceName.includes("VICE-GOVERNOR")) return 1;
      if (raceName.includes("MAYOR")) return 1;
      if (raceName.includes("VICE-MAYOR")) return 1;
      if (raceName.includes("SANGGUNIANG PANLALAWIGAN")) return 2;
      if (raceName.includes("SANGGUNIANG PANLUNGSOD")) return 10;
      return 0;
    };

    const renderDashboard = () => {
      for (const race in aggregate) {
        const raceDiv = document.createElement('div');
        raceDiv.className = 'container';
        raceDiv.innerHTML = `<h2>${race}</h2>`;

        const toggleBtn = document.createElement('button');
        toggleBtn.textContent = 'Hide';
        toggleBtn.className = 'toggle-btn';
        const tableContainer = document.createElement('div');

        let table = `<table><thead><tr><th>#</th><th>Candidate</th><th>Total Votes</th></tr></thead><tbody>`;
        const sortedCandidates = Object.entries(aggregate[race]).sort((a, b) => b[1] - a[1]);
        const highlightLimit = getHighlightLimit(race);

        sortedCandidates.forEach(([name, votes], index) => {
          const highlightClass = index < highlightLimit ? 'highlight' : '';
          table += `<tr class="${highlightClass}"><td>${index + 1}</td><td>${name}</td><td>${votes}</td></tr>`;
        });
        table += `</tbody></table>`;

        tableContainer.innerHTML = table;
        raceDiv.appendChild(toggleBtn);
        raceDiv.appendChild(tableContainer);

        toggleBtn.onclick = () => {
          const isHidden = tableContainer.style.display === 'none';
          tableContainer.style.display = isHidden ? 'block' : 'none';
          toggleBtn.textContent = isHidden ? 'Hide' : 'Show';
        };

        dashboard.appendChild(raceDiv);
      }
    };

    const fetchData = async (id) => {
      try {
        const res = await fetch(`er_results/${id}.json`);
        if (!res.ok) throw new Error('Network response not ok');
        const data = await res.json();
        accumulateVotes(data.national, 'National');
        accumulateVotes(data.local, 'Local');
      } catch (error) {
        console.warn(`Skipping ${id}.json:`, error);
      }
    };

    const loadAll = async () => {
      const fetches = [];
      for (let id = startId; id <= endId; id++) {
        fetches.push(fetchData(id));
      }
      await Promise.all(fetches);
      renderDashboard();
    };

    loadAll();
  </script>
</body>
</html>